<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Rifa Futurista</title>
    <!-- SDK de Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script> 
    
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header> 
            <h1 id="main-title">Sistema de Rifa</h1>
            <img id="business-logo" src="amor_propio_logo.png" alt="Logo del Negocio" class="hidden">
            <p id="raffle-title-display"></p>
            <p id="raffle-prize-info" class="raffle-prize-info hidden">El premio será solo productos de la tienda, no efectivo.</p>
            <p id="raffle-details-display" class="raffle-details"></p>
        </header>

        <div id="entry-panel" class="panel">
            <h2>Bienvenido</h2>
            <p>Selecciona cómo quieres continuar.</p>
            <div id="entry-buttons" class="modal-buttons">
                <button id="customer-entry-btn" class="btn btn-success">Ver Rifa</button>
                <button id="admin-entry-btn" class="btn btn-primary">Administrar Rifa</button>
            </div>
            <div id="admin-login-form" class="hidden mt-20">
                <div class="form-group">
                    <label for="admin-email">Correo Electrónico:</label>
                    <input type="email" id="admin-email" placeholder="admin@ejemplo.com">
                </div>
                <div class="form-group">
                    <label for="admin-password">Contraseña:</label>
                    <input type="password" id="admin-password" placeholder="••••••••">
                </div>
                <button id="login-btn" class="btn btn-primary mt-10">Ingresar</button>
            </div>
            <p id="login-error" class="hidden login-error-text">Contraseña incorrecta.</p>
        </div>

        <div id="admin-config-panel" class="panel hidden">
            <h2>Amor Propio</h2>
            <div id="config-section">
                <h3>Configurar Nueva Rifa</h3>
                <div class="form-group">
                    <label for="raffle-title">Título de la Rifa (Premio):</label>
                    <input type="text" id="raffle-title" placeholder="Ej: Teclado Mecánico RGB">
                </div>
                <div class="form-group">
                    <label for="total-numbers">Cantidad de Números:</label>
                    <input type="number" id="total-numbers" placeholder="Ej: 100" min="1">
                </div>
                <div class="form-group">
                    <label for="raffle-price">Precio del Número (Ej: 2000):</label>
                    <input type="number" id="raffle-price" placeholder="2000" min="0">
                </div>
                <div class="form-group">
                    <label for="raffle-date">Fecha del Sorteo:</label>
                    <input type="date" id="raffle-date">
                </div>
                <div class="form-group">
                    <label for="raffle-lottery-info">Información del Sorteo:</label>
                    <input type="text" id="raffle-lottery-info" value="Juega con las dos últimas cifras de la Lotería de Boyacá">
                </div>
                <button id="create-raffle-btn" class="btn btn-primary">Crear Rifa</button>
            </div>
            
            <div id="manage-section" class="hidden">
                <h3>Gestionar Rifa Actual</h3>
                <div class="form-group">
                    <label for="qr-url">URL para el Código QR:</label>
                    <input type="text" id="qr-url" placeholder="Pega aquí la URL de la página de la rifa">
                </div>
                <div class="form-group">
                    <button id="generate-qr-btn" class="btn btn-secondary">Generar QR</button>
                    <button id="reset-raffle-btn" class="btn btn-danger ml-10">Reiniciar Rifa</button>
                    <button id="logout-btn" class="btn btn-primary ml-10">Cerrar Sesión</button>
                    <button id="toggle-list-btn" class="btn btn-primary mt-10">Mostrar Lista de Participantes</button>
                    <button id="export-csv-btn" class="btn btn-secondary mt-10 ml-10">Exportar a CSV</button>
                </div>
                <div id="participant-list-container" class="hidden">
                    <h3>Lista de Participantes</h3>
                    <table id="participant-table">
                        <thead>
                            <tr>
                                <th>Número</th>
                                <th>Nombre</th>
                                <th>Teléfono</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="participant-list-body"></tbody>
                    </table>
                </div>
                <div id="qr-code-container" class="mt-20">
                    <!-- El código QR y el enlace de descarga se generarán aquí -->
                </div>
            </div>
        </div>

        <div id="participant-view" class="panel hidden">
            <h2>¡Elige tu número de la suerte!</h2>
            <p>Haz clic en un número disponible (verde neón) para registrar tus datos.</p>
            <button id="exit-participant-view-btn" class="btn btn-danger mt-10">Salir</button>
            <div id="raffle-grid"></div>
        </div>

        <div id="winner-display" class="panel hidden">
            <h2>¡Tenemos un ganador!</h2>
            <p>El número ganador es el <strong id="winner-number"></strong></p>
            <p>¡Felicidades a <strong id="winner-name"></strong>!</p>
            <p>Teléfono: <strong id="winner-phone"></strong></p>
        </div>
    </div>

    <!-- Modal para ingresar el nombre del participante -->
    <div id="modal-overlay">
        <div id="name-modal">
            <h3 id="modal-title">Registrar Número</h3>
            <p>Estás a punto de elegir el número <strong id="modal-number-display"></strong>.</p>            
            <p class="modal-price">Precio: $<span id="modal-price-display">2000</span></p>
            <div class="form-group">
                <label for="participant-name-input">Ingresa tu nombre:</label>
                <input type="text" id="participant-name-input" placeholder="Tu nombre aquí">
            </div>
            <div class="form-group">
                <label for="participant-phone-input">Número de Teléfono (Opcional):</label>
                <input type="tel" id="participant-phone-input" placeholder="Tu teléfono de contacto">
            </div>
            <div id="modal-buttons">
                <button id="confirm-name-btn" class="btn btn-success">Confirmar</button>
                <button id="pay-whatsapp-btn" class="btn btn-primary">Pagar por WhatsApp</button>
                <button id="cancel-name-btn" class="btn btn-danger">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- El script ahora se carga desde un archivo externo -->
    <script src="script.js"></script>
</body>
</html>
